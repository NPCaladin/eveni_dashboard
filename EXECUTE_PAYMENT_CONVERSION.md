# 🚀 결제 전환율 기능 실행 가이드

## ✅ 완료된 작업

1. ✅ DB 스키마 생성 파일 작성
2. ✅ 마이그레이션 스크립트 작성
3. ✅ 타입 정의 확장
4. ✅ API 엔드포인트 수정
5. ✅ 차트 컴포넌트 생성
6. ✅ 대시보드 페이지 통합

---

## 📋 실행 순서

### Step 1: Supabase에 테이블 생성 (필수)

**파일**: `supabase_schema_mkt_payment_conversion.sql`

**방법**:
1. Supabase Dashboard 접속
2. SQL Editor 열기
3. `supabase_schema_mkt_payment_conversion.sql` 파일 내용 복사
4. SQL Editor에 붙여넣기
5. **Run** 버튼 클릭

**예상 결과**:
```
✅ mkt_payment_conversion 테이블 생성 완료!
```

---

### Step 2: Excel 데이터를 DB로 마이그레이션 (필수)

**파일**: `migrate_payment_conversion_data.js`

**실행 명령**:
```bash
node migrate_payment_conversion_data.js
```

**예상 결과**:
```
🚀 결제 전환율 데이터 마이그레이션 시작...
📂 Excel 파일 읽는 중...
✅ 50개의 주차 데이터 발견
📊 weekly_reports 데이터 조회 중...
✅ XX개의 주차 보고서 발견
🔄 데이터 매칭 및 변환 중...
✅ 2025년 1주차: 특강 4.76%, 일반 1.29%, 전체 3.10%
...
📊 매칭 결과: 성공 50개, 실패 0개
💾 Supabase에 데이터 삽입 중...
✅ 50개 레코드 삽입 완료!
🔍 데이터 검증 중...
✅ 총 50개 레코드 확인

📊 전체 통계:
  특강: 262/1963명 (13.35%)
  일반: 170/5735명 (2.96%)
  전체: 432/7698명 (5.61%)

✅ 마이그레이션 완료! 🎉
```

---

### Step 3: 개발 서버 재시작

변경된 타입과 API를 반영하기 위해 개발 서버를 재시작하세요.

```bash
# 개발 서버 중지 (Ctrl+C)
# 개발 서버 재시작
npm run dev
```

---

### Step 4: 대시보드 확인

브라우저에서 마케팅 대시보드로 이동:

```
http://localhost:3000/dashboard/marketing
```

**확인 사항**:
1. 페이지 로드 성공
2. "장기 추세 심층 분석" 섹션 확인
3. 새로운 차트 확인: **"💳 DB 유형별 결제 전환율 추이"**
4. 차트 데이터 렌더링 확인
5. 툴팁 기능 확인 (마우스 오버 시)

---

## 🎨 차트 기능

### 시각화 요소

1. **특강 전환율 (Hero)**
   - 색상: #E11D48 (진한 핑크)
   - 두께: 3px
   - 스타일: 굵은 실선

2. **일반 전환율 (Base)**
   - 색상: #9CA3AF (회색)
   - 두께: 2px
   - 스타일: 점선 (비교군)

3. **전체 평균 전환율**
   - 색상: #10B981 (초록)
   - 두께: 2px
   - 스타일: 실선

### 툴팁 정보

마우스를 차트에 올리면 다음 정보 표시:
- 특강: **31.4%** (11/35명)
- 일반: **2.3%** (3/130명)
- 전체: **8.5%** (14/165명)

→ 퍼센트와 함께 실제 수치를 표시하여 "모수가 적어서 퍼센트가 튀는 건가?" 오해 방지

### 기간 필터

우측 상단의 기간 필터로 표시 범위 조정 가능:
- 최근 1개월
- 최근 3개월 (기본)
- 최근 6개월
- 2025년 전체

---

## 🔍 검증 체크리스트

- [ ] Step 1: Supabase 테이블 생성 완료
- [ ] Step 2: 데이터 마이그레이션 완료 (50개 레코드)
- [ ] Step 3: 개발 서버 재시작
- [ ] Step 4: 대시보드 로드 성공
- [ ] Step 5: 새 차트 렌더링 확인
- [ ] Step 6: 특강 라인 (핑크) 표시 확인
- [ ] Step 7: 일반 라인 (회색 점선) 표시 확인
- [ ] Step 8: 전체 라인 (초록) 표시 확인
- [ ] Step 9: 툴팁 기능 동작 확인
- [ ] Step 10: 기간 필터 동작 확인

---

## ⚠️ 문제 해결

### 문제 1: "데이터가 없습니다" 메시지

**원인**: 마이그레이션이 실행되지 않았거나 실패함

**해결**:
```bash
# 데이터 확인
node -e "
const { createClient } = require('@supabase/supabase-js');
const supabase = createClient(process.env.NEXT_PUBLIC_SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY);
supabase.from('mkt_payment_conversion').select('count').then(r => console.log('레코드 수:', r.data));
"

# 0개면 마이그레이션 재실행
node migrate_payment_conversion_data.js
```

### 문제 2: API 에러

**원인**: 타입 불일치 또는 환경변수 문제

**해결**:
1. `.env.local` 파일 확인
2. `NEXT_PUBLIC_SUPABASE_URL` 설정 확인
3. `SUPABASE_SERVICE_ROLE_KEY` 설정 확인
4. 개발 서버 재시작

### 문제 3: 차트가 보이지 않음

**원인**: 빌드 캐시 또는 컴포넌트 import 문제

**해결**:
```bash
# 캐시 삭제 후 재시작
rm -rf .next
npm run dev
```

---

## 📊 예상 결과

### 대시보드 화면

```
📈 장기 추세 심층 분석
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[매체별 전환율 추이 차트]

[주차별 CPA 추이 차트]

[비용 집행 추이]    [DB 유입 추이]

💳 DB 유형별 결제 전환율 추이
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
특강 DB vs 일반 DB의 구매 파워 비교

[라인 차트]
  - 특강 (핑크, 굵은 실선): 평균 13.35%
  - 일반 (회색, 점선): 평균 2.96%
  - 전체 (초록, 실선): 평균 5.61%
```

### 인사이트 도출 가능

1. **특강 DB의 구매력이 4.5배 높음** (13.35% vs 2.96%)
2. **주차별 변동성 확인** (특강은 1~33%, 일반은 0~9%)
3. **마케팅 전략 조정**
   - 특강 유도에 예산 집중
   - 일반 DB의 퀄리티 개선 필요
4. **완전한 퍼널 추적**
   - 광고 → 1차 DB → 상담 DB → **결제** ✨

---

## 🎯 완성!

모든 단계가 완료되면:
- ✅ 결제 전환율 데이터 추적 시스템 구축
- ✅ 특강 vs 일반 DB 비교 차트
- ✅ 실시간 데이터 기반 의사결정 가능
- ✅ 마케팅 ROI 측정 기반 마련

**다음 단계**: 
- 매출 데이터 연동으로 ROI 계산
- 결제 CPA 지표 추가
- 채널별(카카오/메타) 결제 전환 분석


